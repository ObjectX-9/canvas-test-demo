# Canvas ç»„ä»¶ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ¯ ç³»ç»Ÿæ¦‚è§ˆ

æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç±»ä¼¼ Skia çš„ Canvas ç»„ä»¶ç³»ç»Ÿï¼Œæ”¯æŒï¼š

- **èŠ‚ç‚¹æ ‘æ¸²æŸ“**ï¼šæ ¹æ®æ•°æ®è‡ªåŠ¨æ¸²æŸ“ç”¨æˆ·è®¾è®¡å†…å®¹
- **UI è¾…åŠ©å±‚**ï¼šç½‘æ ¼ã€æ ‡å°ºç­‰ä¸åœ¨èŠ‚ç‚¹æ ‘ä¸­çš„ UI å…ƒç´ 
- **åˆ†å±‚æ¸²æŸ“**ï¼šèƒŒæ™¯å±‚ â†’ å†…å®¹å±‚ â†’ UI å‰æ™¯å±‚
- **å£°æ˜å¼ç»„ä»¶**ï¼šç±»ä¼¼ JSX çš„ç»„ä»¶ä½¿ç”¨æ–¹å¼

## ğŸ—ï¸ æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Canvas ç»„ä»¶                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                UI å‰æ™¯å±‚                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚   æ ‡å°º    â”‚  â”‚   å·¥å…·    â”‚  â”‚  é€‰æ‹©æ¡†  â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  å†…å®¹å±‚                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  é¡µé¢èƒŒæ™¯  â”‚  â”‚   çŸ©å½¢    â”‚  â”‚   æ–‡å­—   â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                UI èƒŒæ™¯å±‚                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚    â”‚
â”‚  â”‚  â”‚   ç½‘æ ¼    â”‚  â”‚   èƒŒæ™¯    â”‚                   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ åŸºæœ¬ä½¿ç”¨

### 1. ç®€å•çš„ Canvas

```tsx
import { Canvas, Grid, Ruler, Background } from "../../core/render";

function MyCanvas() {
  return (
    <Canvas
      width={800}
      height={600}
      currentPage={currentPage}
      viewState={viewState}
    >
      {/* èƒŒæ™¯ */}
      <Background backgroundColor="#f8f9fa" />

      {/* ç½‘æ ¼ */}
      <Grid visible={true} gridSize={20} strokeStyle="#e0e0e0" />

      {/* æ ‡å°º */}
      <Ruler visible={true} rulerSize={25} backgroundColor="#f0f0f0" />
    </Canvas>
  );
}
```

### 2. åŠ¨æ€æ§åˆ¶ UI å…ƒç´ 

```tsx
function CanvasWithControls() {
  const [showGrid, setShowGrid] = useState(true);
  const [showRuler, setShowRuler] = useState(true);
  const [gridSize, setGridSize] = useState(20);

  return (
    <div>
      {/* æ§åˆ¶é¢æ¿ */}
      <div>
        <label>
          <input
            type="checkbox"
            checked={showGrid}
            onChange={(e) => setShowGrid(e.target.checked)}
          />
          æ˜¾ç¤ºç½‘æ ¼
        </label>

        <input
          type="range"
          min="10"
          max="50"
          value={gridSize}
          onChange={(e) => setGridSize(Number(e.target.value))}
        />
      </div>

      {/* Canvas */}
      <Canvas currentPage={currentPage}>
        <Grid visible={showGrid} gridSize={gridSize} strokeStyle="#ddd" />
        <Ruler visible={showRuler} />
      </Canvas>
    </div>
  );
}
```

## ğŸ¨ å¯ç”¨ç»„ä»¶

### Background èƒŒæ™¯ç»„ä»¶

```tsx
<Background
  visible={true} // æ˜¯å¦å¯è§
  backgroundColor="#ffffff" // èƒŒæ™¯é¢œè‰²
  zIndex={-20} // å±‚çº§ï¼ˆè´Ÿæ•°ä¸ºèƒŒæ™¯å±‚ï¼‰
/>
```

### Grid ç½‘æ ¼ç»„ä»¶

```tsx
<Grid
  visible={true} // æ˜¯å¦å¯è§
  gridSize={20} // ç½‘æ ¼å¤§å°ï¼ˆåƒç´ ï¼‰
  strokeStyle="#e0e0e0" // çº¿æ¡é¢œè‰²
  lineWidth={1} // çº¿æ¡å®½åº¦
  zIndex={-10} // å±‚çº§
/>
```

### Ruler æ ‡å°ºç»„ä»¶

```tsx
<Ruler
  visible={true} // æ˜¯å¦å¯è§
  rulerSize={25} // æ ‡å°ºåšåº¦ï¼ˆåƒç´ ï¼‰
  backgroundColor="#f0f0f0" // èƒŒæ™¯é¢œè‰²
  textColor="#333" // æ–‡å­—é¢œè‰²
  strokeStyle="#ccc" // è¾¹æ¡†é¢œè‰²
  zIndex={10} // å±‚çº§ï¼ˆæ­£æ•°ä¸ºå‰æ™¯å±‚ï¼‰
/>
```

## ğŸ”§ é«˜çº§ç”¨æ³•

### 1. è‡ªå®šä¹‰ UI æ¸²æŸ“å…ƒç´ 

```tsx
// åˆ›å»ºè‡ªå®šä¹‰æ¸²æŸ“å…ƒç´ 
class CustomUIElement extends UIRenderElement {
  render(context: RenderContext): void {
    const { ctx } = context;

    // è‡ªå®šä¹‰ç»˜åˆ¶é€»è¾‘
    ctx.fillStyle = "red";
    ctx.fillRect(10, 10, 100, 100);
  }
}

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
function MyCanvas() {
  const canvasRef = useRef<CanvasComponentRef>(null);

  useEffect(() => {
    const renderer = canvasRef.current?.getRenderer();
    if (renderer) {
      const customElement = new CustomUIElement();
      renderer.addUIElement(customElement);
    }
  }, []);

  return <Canvas ref={canvasRef} />;
}
```

### 2. è·å–æ¸²æŸ“å™¨å®ä¾‹

```tsx
function AdvancedCanvas() {
  const canvasRef = useRef<CanvasComponentRef>(null);

  const handleRendererReady = (renderer: NodeTreeCanvasRenderer) => {
    // å¯ä»¥ç›´æ¥æ“ä½œæ¸²æŸ“å™¨
    console.log("æ¸²æŸ“å™¨å‡†å¤‡å°±ç»ª:", renderer);

    // æ·»åŠ è‡ªå®šä¹‰UIå…ƒç´ 
    const customGrid = new GridRenderElement({
      gridSize: 50,
      strokeStyle: "red",
      zIndex: -5,
    });
    renderer.addUIElement(customGrid);
  };

  return <Canvas ref={canvasRef} onRendererReady={handleRendererReady} />;
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. åˆ†å±‚æ¸²æŸ“

- **èƒŒæ™¯å±‚** (zIndex < 0)ï¼šç½‘æ ¼ã€èƒŒæ™¯ç­‰ï¼Œä¸éšè§†å›¾å˜æ¢
- **å†…å®¹å±‚** (èŠ‚ç‚¹æ ‘)ï¼šç”¨æˆ·è®¾è®¡å†…å®¹ï¼Œå—è§†å›¾å˜æ¢å½±å“
- **å‰æ™¯å±‚** (zIndex â‰¥ 0)ï¼šæ ‡å°ºã€å·¥å…·ç­‰ï¼Œä¸éšè§†å›¾å˜æ¢

### 2. æ¸²æŸ“è°ƒåº¦

- ä½¿ç”¨ `requestAnimationFrame` é˜²æŠ–æ¸²æŸ“
- åªåœ¨æ•°æ®å˜åŒ–æ—¶é‡å»ºæ¸²æŸ“æ ‘
- UI å…ƒç´ æŒ‰ zIndex æ’åºï¼Œä¼˜åŒ–æ¸²æŸ“é¡ºåº

### 3. å†…å­˜ç®¡ç†

- ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ¸…ç†æ¸²æŸ“å…ƒç´ 
- æ‡’åŠ è½½åˆ›å»ºæ¸²æŸ“å¯¹è±¡
- å±æ€§å˜åŒ–æ—¶è‡ªåŠ¨å¤±æ•ˆç¼“å­˜

## ğŸ¯ ä¸ Skia å¯¹æ¯”

| ç‰¹æ€§       | Skia ç³»ç»Ÿ   | æˆ‘ä»¬çš„ç³»ç»Ÿ          |
| ---------- | ----------- | ------------------- |
| å£°æ˜å¼ç»„ä»¶ | `<ck-rect>` | `<Grid>`, `<Ruler>` |
| åˆ†å±‚æ¸²æŸ“   | âœ…          | âœ…                  |
| äº‹ä»¶ç³»ç»Ÿ   | å¤æ‚        | ç®€åŒ–                |
| æ€§èƒ½       | WebGL       | Canvas2D            |
| æ˜“ç”¨æ€§     | ä¸­ç­‰        | ç®€å•                |

## ğŸ”® æ‰©å±•æ–¹å‘

1. **æ›´å¤š UI ç»„ä»¶**ï¼šé€‰æ‹©æ¡†ã€è¾…åŠ©çº¿ã€åæ ‡è½´ç­‰
2. **åŠ¨ç”»ç³»ç»Ÿ**ï¼šåŸºäº UI å…ƒç´ çš„åŠ¨ç”»æ¡†æ¶
3. **äº¤äº’å¢å¼º**ï¼šæ‹–æ‹½ã€ç¼©æ”¾ã€æ—‹è½¬ç­‰
4. **ä¸»é¢˜ç³»ç»Ÿ**ï¼šæ”¯æŒæ·±è‰²æ¨¡å¼ç­‰ä¸»é¢˜åˆ‡æ¢

è¿™ä¸ªç³»ç»Ÿä¸º Canvas åº”ç”¨æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„ UI æ¸²æŸ“èƒ½åŠ›ï¼ğŸ‰
