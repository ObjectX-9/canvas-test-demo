# æ¸²æŸ“æ¶æ„è®¾è®¡ï¼šæ•°æ®é©±åŠ¨ vs äº‹ä»¶é©±åŠ¨

## ğŸ¤” æ¶æ„é€‰æ‹©é—®é¢˜

å½“å‰é¢ä¸´çš„é—®é¢˜ï¼š**èŠ‚ç‚¹æ•°æ®æ›´æ–°åï¼Œæ¸²æŸ“å™¨æ²¡æœ‰é‡æ–°æ¸²æŸ“**

éœ€è¦å†³å®šé‡‡ç”¨å“ªç§æ¸²æŸ“è§¦å‘æœºåˆ¶ï¼Ÿ

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”åˆ†æ

### 1ï¸âƒ£ æ•°æ®é©±åŠ¨æ¸²æŸ“ (Data-driven Rendering)

```typescript
// ReactçŠ¶æ€å˜åŒ– â†’ è‡ªåŠ¨è§¦å‘æ¸²æŸ“
const [nodeData, setNodeData] = useState(nodes);

// èŠ‚ç‚¹æ›´æ–°
const updateNode = (id: string, changes: Partial<BaseNode>) => {
  setNodeData((prev) =>
    prev.map((node) => (node.id === id ? { ...node, ...changes } : node))
  );
  // âœ… Reactè‡ªåŠ¨è§¦å‘é‡æ¸²æŸ“
};
```

#### âœ… ä¼˜ç‚¹

- **React å“²å­¦**: ç¬¦åˆå•å‘æ•°æ®æµï¼ŒçŠ¶æ€é©±åŠ¨ UI
- **è‡ªåŠ¨åŒæ­¥**: æ•°æ®å˜åŒ–è‡ªåŠ¨è§¦å‘æ¸²æŸ“ï¼Œä¸ä¼šé—æ¼
- **æ˜“äºè°ƒè¯•**: çŠ¶æ€å˜åŒ–æ¸…æ™°å¯è¿½è¸ª
- **æ’¤é”€é‡åš**: å¤©ç„¶æ”¯æŒå†å²çŠ¶æ€ç®¡ç†
- **å®æ—¶åä½œ**: çŠ¶æ€å˜åŒ–å¯ä»¥è½»æ¾å¹¿æ’­ç»™å…¶ä»–ç”¨æˆ·
- **æ—¶é—´æ—…è¡Œ**: æ”¯æŒçŠ¶æ€å¿«ç…§å’Œå›æ”¾

#### âŒ ç¼ºç‚¹

- **æ€§èƒ½å¼€é”€**: æ¯æ¬¡æ›´æ–°éƒ½ç»è¿‡ React æ¸²æŸ“æµç¨‹
- **çŠ¶æ€å¤æ‚**: éœ€è¦è®¾è®¡çŠ¶æ€ç®¡ç†æ¶æ„

---

### 2ï¸âƒ£ äº‹ä»¶é©±åŠ¨æ¸²æŸ“ (Event-driven Rendering)

```typescript
// äº‹ä»¶å¤„ç†å™¨ç›´æ¥è§¦å‘æ¸²æŸ“
class NodeDragHandler {
  handle(event: Event, context: EventContext): void {
    // ç›´æ¥ä¿®æ”¹èŠ‚ç‚¹æ•°æ®
    node.x = newX;
    node.y = newY;

    // âœ… æ‰‹åŠ¨è§¦å‘æ¸²æŸ“
    context.renderer.requestRender();
  }
}
```

#### âœ… ä¼˜ç‚¹

- **é«˜æ€§èƒ½**: è·³è¿‡ Reactï¼Œç›´æ¥æ¸²æŸ“ Canvas
- **ä½å»¶è¿Ÿ**: äº‹ä»¶å¤„ç†å™¨ç«‹å³è§¦å‘æ¸²æŸ“
- **ç²¾ç¡®æ§åˆ¶**: å¯ä»¥æ§åˆ¶ä½•æ—¶æ¸²æŸ“ã€æ¸²æŸ“ä»€ä¹ˆ

#### âŒ ç¼ºç‚¹

- **å®¹æ˜“é—æ¼**: å¿˜è®°è°ƒç”¨`requestRender()`å¯¼è‡´ UI ä¸åŒæ­¥
- **è°ƒè¯•å›°éš¾**: çŠ¶æ€å˜åŒ–ä¸é€æ˜ï¼Œéš¾ä»¥è¿½è¸ª
- **çŠ¶æ€ä¸ä¸€è‡´**: ç›´æ¥ä¿®æ”¹æ•°æ®å¯èƒ½å¯¼è‡´çŠ¶æ€é—®é¢˜
- **éš¾ä»¥æ‰©å±•**: ä¸æ”¯æŒæ’¤é”€é‡åšã€åä½œç­‰é«˜çº§åŠŸèƒ½

---

## ğŸ¯ æ¨èæ–¹æ¡ˆï¼šæ··åˆæ¶æ„

### æ ¸å¿ƒæ€è·¯

- **ä¸»æµç¨‹**: æ•°æ®é©±åŠ¨æ¸²æŸ“ï¼ˆç¡®ä¿çŠ¶æ€ä¸€è‡´æ€§ï¼‰
- **ä¼˜åŒ–è·¯å¾„**: äº‹ä»¶é©±åŠ¨æ¸²æŸ“ï¼ˆæå‡äº¤äº’æ€§èƒ½ï¼‰
- **æœ€ç»ˆåŒæ­¥**: æ“ä½œç»“æŸæ—¶åŒæ­¥åˆ° React çŠ¶æ€

### å®ç°ç­–ç•¥

#### 1. é«˜é¢‘äº¤äº’ä¼˜åŒ–ï¼ˆæ‹–æ‹½è¿‡ç¨‹ä¸­ï¼‰

```typescript
class NodeDragHandler {
  handle(event: Event, context: EventContext): void {
    // ğŸš€ å®æ—¶æ›´æ–°ï¼šç›´æ¥ä¿®æ”¹+ç«‹å³æ¸²æŸ“
    node.x = newX;
    node.y = newY;
    context.renderer.requestRender(); // é«˜æ€§èƒ½è·¯å¾„

    // ä¸ç«‹å³åŒæ­¥åˆ°ReactçŠ¶æ€ï¼ˆé¿å…é«˜é¢‘æ›´æ–°ï¼‰
  }
}

class NodeDragEndHandler {
  handle(event: Event, context: EventContext): void {
    // ğŸ”„ æœ€ç»ˆåŒæ­¥ï¼šåŒæ­¥åˆ°ReactçŠ¶æ€
    context.updateNodeData(draggingNodeId, {
      x: node.x,
      y: node.y,
    });
    // ReactçŠ¶æ€æ›´æ–°åä¼šè‡ªåŠ¨é‡æ¸²æŸ“ï¼ˆç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼‰
  }
}
```

#### 2. æ™®é€šæ“ä½œï¼ˆåˆ›å»ºã€åˆ é™¤ã€å±æ€§ä¿®æ”¹ï¼‰

```typescript
// ç›´æ¥ä½¿ç”¨ReactçŠ¶æ€ç®¡ç†
const createNode = (nodeData: Partial<BaseNode>) => {
  setNodes((prev) => [...prev, new BaseNode(nodeData)]);
  // âœ… Reactè‡ªåŠ¨è§¦å‘é‡æ¸²æŸ“
};
```

## ğŸ—ï¸ å…·ä½“å®ç°æ–¹æ¡ˆ

### ç¬¬ä¸€é˜¶æ®µï¼šä¿®å¤å½“å‰é—®é¢˜

```typescript
// 1. EventContextä¸­åŠ å…¥æ¸²æŸ“å™¨å¼•ç”¨
interface EventContext {
  // ... ç°æœ‰å±æ€§
  renderer: NodeTreeCanvasRenderer; // æ–°å¢
}

// 2. äº‹ä»¶å¤„ç†å™¨ä¸­è§¦å‘æ¸²æŸ“
class NodeDragHandler {
  handle(event: Event, context: EventContext): void {
    // æ›´æ–°èŠ‚ç‚¹
    node.x = newX;
    node.y = newY;

    // ğŸ‘† ç«‹å³æ¸²æŸ“ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
    context.renderer.requestRender();
  }
}
```

### ç¬¬äºŒé˜¶æ®µï¼šå®Œå–„çŠ¶æ€ç®¡ç†

```typescript
// 1. è®¾è®¡çŠ¶æ€æ›´æ–°æ¥å£
interface EventContext {
  // ... ç°æœ‰å±æ€§
  updateNodeData: (id: string, changes: Partial<BaseNode>) => void;
}

// 2. æ“ä½œç»“æŸæ—¶åŒæ­¥çŠ¶æ€
class NodeDragEndHandler {
  handle(event: Event, context: EventContext): void {
    this.nodeSelectionHandler.stopDragging();

    // ğŸ”„ åŒæ­¥åˆ°ReactçŠ¶æ€
    const node = this.getUpdatedNode();
    context.updateNodeData(node.id, {
      x: node.x,
      y: node.y,
    });
  }
}
```

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| åœºæ™¯       | æ•°æ®é©±åŠ¨   | äº‹ä»¶é©±åŠ¨   | æ··åˆæ–¹æ¡ˆ   |
| ---------- | ---------- | ---------- | ---------- |
| æ‹–æ‹½æµç•…åº¦ | â­â­â­     | â­â­â­â­â­ | â­â­â­â­â­ |
| çŠ¶æ€ä¸€è‡´æ€§ | â­â­â­â­â­ | â­â­       | â­â­â­â­â­ |
| å¼€å‘å¤æ‚åº¦ | â­â­â­â­   | â­â­â­     | â­â­â­     |
| å¯ç»´æŠ¤æ€§   | â­â­â­â­â­ | â­â­       | â­â­â­â­   |
| æ‰©å±•æ€§     | â­â­â­â­â­ | â­â­       | â­â­â­â­â­ |

## ğŸ‰ ç»“è®º

**æ¨èæ··åˆæ¶æ„**ï¼š

- âœ… ä¿æŒ React æ•°æ®é©±åŠ¨çš„æ ¸å¿ƒä¼˜åŠ¿
- âœ… åœ¨å…³é”®äº¤äº’è·¯å¾„ä¸Šä¼˜åŒ–æ€§èƒ½
- âœ… ç¡®ä¿çŠ¶æ€æœ€ç»ˆä¸€è‡´æ€§
- âœ… ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•å¥ å®šåŸºç¡€

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼š

1. ä¿®å¤ EventContextï¼ŒåŠ å…¥ renderer å¼•ç”¨
2. åœ¨æ‹–æ‹½äº‹ä»¶ä¸­åŠ å…¥`requestRender()`è°ƒç”¨
3. æµ‹è¯•æ‹–æ‹½æµç•…åº¦
4. (å¯é€‰) å®ç°çŠ¶æ€åŒæ­¥æœºåˆ¶
